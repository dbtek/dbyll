I"£<p><br /><br /></p>

<h1 id="ì—°ê´€ê´€ê³„-í…ŒìŠ¤íŠ¸">ì—°ê´€ê´€ê³„ í…ŒìŠ¤íŠ¸</h1>
<p><br /><br />
<strong><em>í˜„ ê²Œì‹œë¬¼ì€ â€˜ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ë¶€íŠ¸ ì›¹ í”„ë¡œì íŠ¸â€™ ë¼ëŠ” ì„œì ì„ ê³µë¶€í•˜ë©´ì„œ ê°œì¸ì ìœ¼ë¡œ ë©”ëª¨í•˜ê³  ê³µë¶€í•˜ê¸° ìœ„í•´ì„œ ì‘ì„±í•˜ëŠ” ê¸€ì…ë‹ˆë‹¤.</em></strong>
â€”</p>

<p>ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì„ PK ìª½ì—ì„œë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. í”„ë¡œì íŠ¸ë¥¼ ë‹¤ìŒ ê·¸ë¦¼ê³¼ ê°™ì´ êµ¬ì„±í•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-17-19-16-01.png" alt="" /></p>

<p><br /></p>

<p>ì‘ì„±í•˜ëŠ” MemberRepositoryTestsì—ëŠ” MemberRepositoryë¥¼ ì£¼ì…í•˜ê³  ì˜ˆì œë¡œ ì‚¬ìš©í•  Member ê°ì²´ë¥¼ 100ê°œ ì¶”ê°€í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.</p>

<p><br /></p>

<p><strong>MemberRepositoryTests í´ë˜ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Member</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberRepositoryTests</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertMembers</span><span class="o">(){</span>
        <span class="nc">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">100</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">i</span><span class="o">-&gt;{</span>
            <span class="nc">Member</span> <span class="n">member</span><span class="o">=</span><span class="nc">Member</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">email</span><span class="o">(</span><span class="s">"user"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">"@aaa.com"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"1111"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">"USER"</span><span class="o">+</span><span class="n">i</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p><br /></p>

<p>í…ŒìŠ¤íŠ¸ì˜ ì‹¤í–‰ ê²°ê³¼ë¡œ ë°ì´íŠ¸ë² ì´ìŠ¤ì— íšŒì› ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.</p>

<p>BoardRepositoryTests ì½”ë“œ ì—­ì‹œ ë™ì¼í•œ íŒ¨í‚¤ì§€ì— ì¶”ê°€í•˜ê³  ì•ì—ì„œ ë§Œë“¤ì–´ì§„ íšŒì› ë°ì´í„°ë¥¼ ì´ìš©í•´ì„œ Board ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ì¶”ê°€í•˜ë„ë¡ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.</p>

<p><br /></p>

<p><strong>BoardRepositoryTests í´ë˜ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Board</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Member</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardRepositoryTests</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">BoardRepository</span> <span class="n">boardRepository</span><span class="o">;</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertBoard</span><span class="o">(){</span>
        <span class="nc">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">100</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">i</span><span class="o">-&gt;{</span>
            <span class="nc">Member</span> <span class="n">member</span><span class="o">=</span> <span class="nc">Member</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">email</span><span class="o">(</span><span class="s">"user"</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="s">"@aaa.com"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
            <span class="nc">Board</span> <span class="n">board</span><span class="o">=</span><span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">title</span><span class="o">(</span><span class="s">"Title..."</span><span class="o">+</span><span class="n">i</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="s">"Content...."</span><span class="o">+</span><span class="n">i</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">writer</span><span class="o">(</span><span class="n">member</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="n">boardRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><br /></p>

<p>testInsert()ëŠ” í•œ ëª…ì˜ ì‚¬ìš©ìê°€ í•˜ë‚˜ì˜ ê²Œì‹œë¬¼ì„ ë“±ë¡í•˜ë„ë¡ ì‘ì„±ë˜ì—ˆë‹¤. í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ í™•ì¸í•œë‹¤.</p>

<p>ëŒ“ê¸€ì€ ReplyRepositoryTest í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•´ì„œ íŠ¹ì •í•œ ì„ì˜ì˜ ê²Œì‹œê¸€ì„ ëŒ€ìƒìœ¼ë¡œ ëŒ“ê¸€ì„ ì¶”ê°€í•œë‹¤. í˜„ì¬ ê²Œì‹œê¸€ì€ 1ë²ˆë¶€í„° 100ë²ˆê¹Œì§€ì˜ ì„ì˜ì˜ ë²ˆí˜¸ë¥¼ ì´ìš©í•´ì„œ 300ê°œì˜ ëŒ“ê¸€ì„ ì¶”ê°€í•œë‹¤.</p>

<p><br /></p>

<p><strong>ReplyRepositoryTests í´ë˜ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Board</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Reply</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.IntStream</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReplyRepositoryTests</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ReplyRepository</span> <span class="n">replyRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertReply</span><span class="o">(){</span>
        <span class="nc">IntStream</span><span class="o">.</span><span class="na">rangeClosed</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">300</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">i</span><span class="o">-&gt;{</span>
            <span class="kt">long</span> <span class="n">bno</span><span class="o">=(</span><span class="kt">long</span><span class="o">)(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">100</span><span class="o">)+</span><span class="mi">1</span><span class="o">;</span>
            <span class="nc">Board</span> <span class="n">board</span><span class="o">=</span> <span class="nc">Board</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">bno</span><span class="o">(</span><span class="n">bno</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>

            <span class="nc">Reply</span> <span class="n">reply</span><span class="o">=</span><span class="nc">Reply</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">text</span><span class="o">(</span><span class="s">"Reply......"</span><span class="o">+</span><span class="n">i</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">board</span><span class="o">(</span><span class="n">board</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">replyer</span><span class="o">(</span><span class="s">"guest"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
            <span class="n">replyRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">reply</span><span class="o">);</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>insertReply()ëŠ” 300ê°œì˜ ëŒ“ê¸€ì„ 1~100 ì‚¬ì´ì˜ ë²ˆí˜¸ë¡œ ì¶”ê°€í•œë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” 1ë²ˆë¶€í„° 100ë²ˆê¹Œì§€ ê²Œì‹œë¬¼ì— ëŒ€í•´ì„œ nê°œì˜ ëŒ“ê¸€ì´ ì¶”ê°€ëœë‹¤.</p>

<p><br /></p>

<p>ë°ì´í„° ì¶”ê°€ê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ì´ì œ í™”ë©´ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ì •ë¦¬í•´ ë³¸ë‹¤.</p>

<ul>
  <li>ëª©ë¡ í™”ë©´: ê²Œì‹œê¸€ì˜ ë²ˆí˜¸, ì œëª©, ëŒ“ê¸€ ê°œìˆ˜, ì‘ì„±ìì˜ ì´ë¦„/ì´ë©”ì¼</li>
</ul>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-17-19-36-04.png" alt="" /></p>

<p><br /></p>

<ul>
  <li>ì¡°íšŒ í™”ë©´: ê²Œì‹œê¸€ì˜ ë²ˆí˜¸, ì œëª©, ë‚´ìš©, ëŒ“ê¸€ ê°œìˆ˜, ì‘ì„±ì ì´ë¦„/ì´ë©”ì¼</li>
</ul>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-17-19-36-55.png" alt="" /></p>

<p><br /></p>

<p>ì—”í‹°í‹° í´ë˜ìŠ¤ë“¤ì€ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ìƒì—ì„œëŠ” ë‘ ê°œ í˜¹ì€ ë‘ ê°œ ì´ìƒì˜ í…Œì´ë¸”ë¡œ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³  ìˆë‹¤ëŠ” ê²ƒì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì…ì¥ìœ¼ë¡œ ë³´ë©´ ì¡°ì¸ì´ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ì‹¤ì œë¡œ @ManyToOneì˜ ê²½ìš°ì—ëŠ” <strong>FK ìª½ì˜ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ PK ìª½ì˜ ì—”í‹°í‹°ë„ ê°™ì´ ê°€ì ¸ì˜¨ë‹¤.</strong></p>

<p>BoardRepositoryTestsë¥¼ í†µí•´ì„œ Memberë¥¼ @ManyToOneìœ¼ë¡œ ì°¸ì¡°í•˜ê³  ìˆëŠ” Boardë¥¼ ì¡°íšŒí•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ ë³¸ë‹¤.</p>

<p><br /></p>

<p><strong>BoardRepositoryTests í´ë˜ìŠ¤ ì¼ë¶€</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRead1</span><span class="o">(){</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">boardRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">100L</span><span class="o">);</span>
        <span class="nc">Board</span> <span class="n">board</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">board</span><span class="o">.</span><span class="na">getWriter</span><span class="o">());</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì¿¼ë¦¬ê°€ ë‚´ë¶€ì ìœ¼ë¡œ left outer join ì²˜ë¦¬ê°€ ëœ ê²ƒì„ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.</p>

<p>Replyì™€ Board ì—­ì‹œ @ManyToOneì˜ ê´€ê³„ì´ë¯€ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë©´ ìë™ìœ¼ë¡œ ì¡°ì¸ì´ ì²˜ë¦¬ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><strong>ReplyRepositoryTests í´ë˜ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">readReply1</span><span class="o">(){</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Reply</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">replyRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
        <span class="nc">Reply</span> <span class="n">reply</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">reply</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">reply</span><span class="o">.</span><span class="na">getBoard</span><span class="o">());</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ì¡°ì¸ì´ ì²˜ë¦¬ëœ ì¿¼ë¦¬ê°€ ì‹¤í–‰ì´ ëœë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-18-12-26-49.png" alt="" /></p>

<p><br /></p>

<p>ì‹¤í–‰ëœ SQLì„ ë³´ë©´ reply í…Œì´ë¸”, board í…Œì´ë¸”, member í…Œì´ë¸”ê¹Œì§€ ëª¨ë‘ ì¡°ì¸ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë° Replyë¥¼ ê°€ì ¸ì˜¬ ë•Œ ë§¤ë²ˆ Boardì™€ Memberê¹Œì§€ ì¡°ì¸í•´ì„œ ê°€ì ¸ì˜¬ í•„ìš”ê°€ ë§ì§€ëŠ” ì•Šìœ¼ë¯€ë¡œ ìœ„ì™€ ê°™ì€ ì—¬ëŸ¬ í…Œì´ë¸”ì´ ì¡°ì¸ìœ¼ë¡œ ì²˜ë¦¬ë˜ëŠ” ìƒí™©ì€ ê·¸ë‹¤ì§€ íš¨ìœ¨ì ì´ì§€ ì•Šë‹¤.</p>

<p>ìœ„ì™€ ê°™ì´ ì—°ê´€ê´€ê³„ë¥¼ ê°€ì§„ ëª¨ë“  ì—”í‹°í‹°ë¥¼ ê°™ì´ ë¡œë”©í•˜ëŠ” ê²ƒì„ â€˜Eagar loadingâ€™ì´ë¼ê³  í•˜ëŠ”ë° â€˜ì¦‰ì‹œ ë¡œë”©â€™ì´ë¼ëŠ” ìš©ì–´ë¡œ í‘œí˜„í•œë‹¤. ì´ëŠ” ëª¨ë“  ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ ì—¬ëŸ¬ ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³  ìˆê±°ë‚˜ ì—°ê´€ê´€ê³„ê°€ ë³µì¡í•´ì§ˆìˆ˜ë¡ ì¡°ì¸ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ë¥¼ í”¼í•  ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ JPAì—ì„œëŠ” ì—°ê´€ê´€ê³„ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ì˜¬ ê²ƒì¸ê°€ì— ëŒ€í•´ì„œ fetchë¼ê³  í•˜ëŠ” ê²ƒì„ ì •ì˜ í•œë‹¤.</p>

<p>ì¦‰ì‹œ ë¡œë”©ì´ ë¶ˆí•„ìš”í•œ ì¡°ì¸ê¹Œì§€ ì²˜ë¦¬í•œë‹¤ë©´ ê·¸ì™€ ë°˜ëŒ€ë˜ëŠ” ê°œë…ì´ â€˜Lazy Loadingâ€™ì´ë‹¤. 
Board í´ë˜ìŠ¤ë¥¼ ìˆ˜ì •í•´ë³´ì.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-18-12-30-23.png" alt="" /></p>

<p><br /></p>

<p><strong>Lazy loadingë¥¼ ì‚¬ìš©í•˜ëŠ” Board í´ë˜ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span><span class="o">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="s">"writer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span><span class="o">=</span><span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Member</span> <span class="n">writer</span><span class="o">;</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>Lazy loadingë¥¼ ì ìš©í–ˆë‹¤ë©´ ë‹¤ì‹œ BoardRepositorTestsì˜ testRead1()ì„ ì‹¤í–‰í•´ë³´ì.
ì‹¤í–‰í•´ë³´ë©´ ì•Œê² ì§€ë§Œ ì˜¤ë¥˜ê°€ ë‚ ê²ƒì´ë‹¤. ê·¸ ì´ìœ ëŠ” ë°”ë¡œ board.getWriter() ë•Œë¬¸ì¸ë° ì´ëŠ” member í…Œì´ë¸”ì„ ë¡œë”©í•´ì•¼ í•˜ëŠ”ë° ì´ë¯¸ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ê²°ì€ ëë‚œ ìƒíƒœì´ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ë˜ì„œ ì˜¤ë¥˜ ë‚´ìš© ì¤‘ì— â€˜no Sessionâ€™ì´ë¼ëŠ” ë‚´ìš©ì€ ê·¸ëŸ¬í•œ ë‚´ìš©ì´ë‹¤.</p>

<p>ì´ëŸ¬í•œ ë¬´ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ì‹œ í•œë²ˆ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì—°ê²°ì´ í•„ìš”í•œë° @Transactionalì´ ë°”ë¡œ í•´ê²°ì±…ì´ë‹¤. ê·¸ë˜ì„œ ì´ê²ƒì„ ë‹¤ì‹œ ì¶”ê°€í•´ì¤€ë‹¤.</p>

<p><br /></p>

<p><strong>BoardRepositoryTests</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Transactional</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testRead1</span><span class="o">(){</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">boardRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="mi">100L</span><span class="o">);</span>
        <span class="nc">Board</span> <span class="n">board</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">board</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">board</span><span class="o">.</span><span class="na">getWriter</span><span class="o">());</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>íŠ¸ëœì­ì…˜ ì–´ë…¸í…Œì´ì…˜ì€ í•„ìš”í•  ë•Œ ë‹¤ì‹œ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ì´ ìƒì„±ëœë‹¤. ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ board í…Œì´ë¸”ë§Œì„ ë¡œë”©í•´ì„œ ì²˜ë¦¬í•˜ê³  ìˆì§€ë§Œ getWriter()ë¥¼ í•˜ê¸° ìœ„í•´ì„œ memeber í…Œì´ë¸”ì„ ë¡œë”©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><strong>ì—°ê´€ê´€ê³„ì—ì„œì˜ @ToString() ì£¼ì˜ì‚¬í•­</strong></p>

<p>ë‚´ê°€ Board ê°ì²´ì˜ @ToString()ì„ í•˜ê²Œ ë˜ë©´ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ëª¨ë“  ë©¤ë²„ ë³€ìˆ˜ë¥¼ ì¶œë ¥í•˜ê²Œ ë˜ëŠ”ë° ì´ëŠ” Boardì˜ ê°ì²´ì™€ writer ë³€ìˆ˜ë¡œ ì„ ì–¸ëœ Member ê°ì²´ ì—­ì‹œ ì¶œë ¥í•˜ê²Œ ëœë‹¤. ì¦‰ Memberë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•´ì„œëŠ” Memeber ê°ì²´ì˜ toString()ì´ í˜¸ì¶œë˜ì–´ì•¼ í•˜ê³  ì´ë•Œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ í•„ìš”í•˜ê²Œ ëœë‹¤.</p>

<p>ì´ëŸ° ë¬¸ì œë¡œ ì¸í•´ ì—°ê´€ê´€ê³„ê°€ ìˆëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ê²½ìš° @ToString()ì„ í•  ë•ŒëŠ” ìŠµê´€ì ìœ¼ë¡œ <strong>exclude ì†ì„±</strong>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p>

<p>excludeëŠ” í•´ë‹¹ ì†ì„±ê°’ìœ¼ë¡œ ì§€ì •ëœ ë³€ìˆ˜ëŠ” toString()ì—ì„œ ì œì™¸í•˜ê¸° ë•Œë¬¸ì— ì§€ì—° ë¡œë”©ì„ í•  ë•ŒëŠ” ë°˜ë“œì‹œ ì§€ì •í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.</p>

<p><br /></p>

<h2 id="jpqlê³¼-leftouter-join"><strong>JPQLê³¼ left(outer) join</strong></h2>

<p><br /></p>

<p>ëª©ë¡ í™”ë©´ì—ì„œ ê²Œì‹œê¸€ì˜ ì •ë³´ì™€ í•¨ê»˜ ëŒ“ê¸€ì˜ ìˆ˜ë¥¼ ê°™ì´ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ì„œëŠ” ë‹¨ìˆœíˆ í•˜ë‚˜ì˜ ì—”í‹°í‹° íƒ€ì…ì„ ì´ìš©í•  ìˆ˜ ì—†ë‹¤. ì´ì— ëŒ€í•œ í•´ê²°ì±… ì¤‘ì—ì„œ ê°€ì¥ ë§ì´ ì“°ì´ëŠ” ë°©ì‹ì€ JPQLì˜ ì¡°ì¸(join)ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>Boardì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ë‚´ë¶€ì—ëŠ” Member ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ê³ , ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³  ìˆë‹¤. ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” Boardì˜ wrtier ë³€ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì¡°ì¸ì„ ì²˜ë¦¬í•œë‹¤.</p>

<p><br /></p>

<p><strong>BoardRepository ì¸í„°í˜ì´ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.repository.query.Param</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Board</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.repository.search.SearchBoardRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BoardRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">SearchBoardRepository</span> <span class="o">{</span>
    <span class="c1">//í•œ ê°œì˜ ë¡œìš°(Object) ë‚´ì— Object[]ë¡œ ë‚˜ì˜´</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"select b, w from Board b left join b.writer w where b.bno=:bno"</span><span class="o">)</span>
    <span class="nc">Object</span> <span class="nf">getBoardWithWriter</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"bno"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">);</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>getBoardWithWriter()ëŠ” Boardë¥¼ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ, Memberë¥¼ ê°™ì´ ì¡°íšŒí•´ì•¼ í•˜ëŠ” ìƒí™©ì´ë‹¤. Board í´ë˜ìŠ¤ì—ëŠ” Memberì™€ì˜ ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³  ìˆìœ¼ë¯€ë¡œ b.writerì™€ ê°™ì€ í˜•íƒœë¡œ ì‚¬ìš©í•œë‹¤. ì´ì²˜ëŸ¼ ë‚´ë¶€ì— ìˆëŠ” ì—”í‹°í‹°ë¥¼ ì´ìš©í•  ë•ŒëŠ” â€˜LEFT JOINâ€™ ë’¤ì— â€˜ONâ€™ì„ ì´ìš©í•˜ëŠ” ë¶€ë¶„ì´ ì—†ë‹¤. ì‘ì„±í•œ getBoardWithWriter()ë¥¼ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ í™•ì¸í•˜ì.</p>

<p><br /></p>

<p><strong>BoardRepositoryTests í…ŒìŠ¤í¬ ì½”ë“œ</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testReadWithWriter</span><span class="o">(){</span>
        <span class="nc">Object</span> <span class="n">result</span><span class="o">=</span><span class="n">boardRepository</span><span class="o">.</span><span class="na">getBoardWithWriter</span><span class="o">(</span><span class="mi">100L</span><span class="o">);</span>
        <span class="nc">Object</span><span class="o">[]</span> <span class="n">arr</span><span class="o">=(</span><span class="nc">Object</span><span class="o">[])</span><span class="n">result</span><span class="o">;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"-------------------------------"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">arr</span><span class="o">));</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p><br /></p>

<p>í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ë©´ ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìœ¼ë‚˜ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ë¥¼ ë³´ë©´ ì¡°ì¸ ì²˜ë¦¬ê°€ ë˜ì–´ í•œ ë²ˆì— board í…Œì´ë¸”ê³¼ member í…Œì´ë¸”ì„ ì´ìš©í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-18-12-54-46.png" alt="" /></p>

<p>ì‘ë™í•˜ëŠ” ì›ë¦¬ë¥¼ ë³´ë©´ BoardRepository ì¸í„°í˜ì´ìŠ¤ì˜ getBoardWithWriter í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ bnoê°€ ìœ„ì˜ @Queryë¶€ë¶„ì˜ ë§ˆì§€ë§‰ b.bno=:bnoì—ì„œ =:bnoì˜ ë“¤ì–´ê°€ê²Œëœë‹¤. ê·¸ëŸ¬ë©´ ì´ bnoë¥¼ ê¸°ì¤€ìœ¼ë¡œí•´ì„œ Board bì— writerë¥¼ Left outer joiní•˜ëŠ” ê²ƒì´ë‹¤.
@Queryë¶€ë¶„ì„ ë³´ë©´ select b, w ì´ ë¶€ë¶„ì€ boardì˜ b ê·¸ë¦¬ê³  memberì˜ wì¸ë° ê° ì—”í‹°í‹°ì˜ where ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  í•„ë“œë“¤ì„ ê°€ì ¸ì˜¨ë‹¤.</p>

<p><strong><a href="https://haenny.tistory.com/34">Left Outer Joinì˜ ê°œë…</a></strong></p>

<p><br /></p>

<p>Boardì™€ Member ì‚¬ì´ì—ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ì°¸ì¡°ë¥¼ í†µí•´ì„œ ì—°ê´€ê´€ê³„ê°€ ìˆì§€ë§Œ Boardì™€ ReplyëŠ” ì¢€ ìƒí™©ì´ ë‹¤ë¥´ë‹¤.</p>

<p><strong>Reply ìª½ì´ @ManyToOneìœ¼ë¡œ ì°¸ì¡°í•˜ê³  ìˆìœ¼ë‚˜ Board ì…ì¥ì—ì„œëŠ” Reply ê°ì²´ë“¤ì„ ì°¸ì¡°í•˜ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ë°œìƒí•œë‹¤.</strong></p>

<p>ì´ëŸ° ê²½ìš°ì—ëŠ” ì§ì ‘ ì¡°ì¸ì— í•„ìš”í•œ ì¡°ê±´ì€ <strong>â€˜onâ€™</strong>ì„ ì´ìš©í•´ì„œ ì‘ì„±í•´ ì¤˜ì•¼ í•œë‹¤.</p>

<p><strong>â€˜íŠ¹ì • ê²Œì‹œë¬¼ê³¼ í•´ë‹¹ ê²Œì‹œë¬¼ì— ì†í•œ ëŒ“ê¸€ë“¤ì„ ì¡°íšŒâ€™</strong>í•´ì•¼ í•˜ëŠ” ìƒí™©ì„ ê³ ë ¤í•´ ë³´ì. ì´
ë•ŒëŠ” boardì™€ reply í…Œì´ë¸”ì„ ì¡°ì¸í•´ì„œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê²Œ ëœë‹¤.</p>

<p><strong><a href="https://blog.leocat.kr/notes/2017/07/28/sql-join-on-vs-where">SQL ONê³¼ WHEREì˜ ì°¨ì´ì </a></strong></p>

<p>ì œì¼ ì¤‘ìš”í•œ ê²ƒì€ @Query ë¶€ë¶„ì— ON r.board=b ê°€ ìˆì–´ì•¼ ëœë‹¤ëŠ” ê²ƒì´ë‹¤. ì—°ê´€ê´€ê³„ê°€ ìˆëŠ” ê²½ìš°ì™€ ë¹„êµí•´ ë³´ë©´ ì¤‘ê°„ì— â€˜onâ€™ì´ ì‚¬ìš©ë˜ë©´ì„œ ì¡°ì¸ ì¡°ê±´ì„ ì§ì ‘ ì§€ì •í•˜ëŠ” ë¶€ë¶„ì´ ì¶”ê°€ë˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>ì´ì œ BoardRepositoryTests í´ë˜ìŠ¤ì— í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ì.</p>

<p><br /></p>

<p><strong>BoardRepositoryTests</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetBoardWithReply</span><span class="o">(){</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">boardRepository</span><span class="o">.</span><span class="na">getBoardWithReply</span><span class="o">(</span><span class="mi">100L</span><span class="o">);</span>

        <span class="k">for</span><span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="nl">arr:</span> <span class="n">result</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">arr</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ê°€ ë‚˜ì˜¨ë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-18-13-32-38.png" alt="" /></p>

<p>ë‹¤ì‹œ ëª©ë¡ í™”ë©´ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì •ë¦¬í•´ ë³´ì</p>

<ul>
  <li>ê²Œì‹œë¬¼(Board): ê²Œì‹œë¬¼ì˜ ë²ˆí˜¸, ì œëª©, ê²Œì‹œë¬¼ì˜ ì‘ì„± ì‹œê°„</li>
  <li>íšŒì›(Member): íšŒì›ì˜ ì´ë¦„/ì´ë©”ì¼</li>
  <li>ëŒ“ê¸€(Reply): í•´ë‹¹ ê²Œì‹œë¬¼ì˜ ëŒ“ê¸€ ìˆ˜</li>
</ul>

<p>ì € ì„¸ ì—”í‹°í‹° ì¤‘ì—ì„œ ìš°ë¦¬ê°€ ê°€ì¥ ë§ì´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê²Œ ë  ì—”í‹°í‹°ëŠ” Boardì´ë‹¤ ê·¸ë˜ì„œ Boardë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì¸ ê´€ê³„ë¥¼ ì‘ì„±í•œë‹¤.</p>

<p><strong>MemberëŠ” Board ë‚´ì— wrtier ë¼ëŠ” í•„ë“œë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³  ìˆê³  ReplyëŠ” ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ìƒí™©ì´ë‹¤.</strong></p>

<p>ì¡°ì¸ í›„ì—ëŠ” Boardë¥¼ ê¸°ì¤€ìœ¼ë¡œ â€˜GROUP BYâ€™ ì²˜ë¦¬ë¥¼ í•´ì„œ **í•˜ë‚˜ì˜ ê²Œì‹œë¬¼ ë‹¹ í•˜ë‚˜ì˜ ë¼ì¸ì´ ë  ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬í•´ì•¼ í•œë‹¤.</p>

<p>BoardRepositoryì—ëŠ” Pageableì„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë°›ê³ , Page&lt;Object[]&gt; ë¦¬í„´ íƒ€ì…ì˜ getBoardWithReplyCount()ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.</p>

<p><br /></p>

<p><strong>BoardRepository ì¸í„°í˜ì´ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.repository.query.Param</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Board</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.repository.search.SearchBoardRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BoardRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">SearchBoardRepository</span> <span class="o">{</span>
    <span class="c1">//í•œ ê°œì˜ ë¡œìš°(Object) ë‚´ì— Object[]ë¡œ ë‚˜ì˜´</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"select b, w from Board b left join b.writer w where b.bno=:bno"</span><span class="o">)</span>
    <span class="nc">Object</span> <span class="nf">getBoardWithWriter</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"bno"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">);</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT b, r FROM Board b LEFT JOIN Reply r ON r.board=b WHERE b.bno=:bno"</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="nf">getBoardWithReply</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"bno"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">);</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"SELECT b, w, count(r) "</span> <span class="o">+</span>
    <span class="s">" FROM Board b "</span><span class="o">+</span>
    <span class="s">" LEFT JOIN b.writer w "</span><span class="o">+</span>
    <span class="s">" LEFT JOIN Reply r ON r.board=b"</span><span class="o">+</span>
    <span class="s">" GROUP BY b"</span><span class="o">,</span>
    <span class="n">countQuery</span> <span class="o">=</span><span class="s">"SELECT count(b) FROM Board b"</span><span class="o">)</span>
    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="nf">getBoardWithReplyCount</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>BoardRepositoryTestsì—ëŠ” ì •ìƒì ìœ¼ë¡œ JPQLì´ ë™ì‘ ê°€ëŠ¥í•œì§€ í™•ì¸í•´ ì¤€ë‹¤.</p>

<p><br /></p>

<p><strong>BoardRepositoryTests í´ë˜ìŠ¤ ì¼ë¶€</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testWithReplyCount</span><span class="o">(){</span>
        <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">=</span> <span class="nc">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="s">"bno"</span><span class="o">).</span><span class="na">descending</span><span class="o">());</span>
        <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">result</span><span class="o">=</span><span class="n">boardRepository</span><span class="o">.</span><span class="na">getBoardWithReplyCount</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">row</span><span class="o">-&gt;{</span>
            <span class="nc">Object</span><span class="o">[]</span> <span class="n">arr</span><span class="o">=(</span><span class="nc">Object</span><span class="o">[])</span><span class="n">row</span><span class="o">;</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">arr</span><span class="o">));</span>
        <span class="o">});</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>1í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•œë‹¤ê³  ê°€ì •í•˜ê³  í˜ì´ì§€ ë²ˆí˜¸ëŠ” 0ìœ¼ë¡œ ì§€ì •í•˜ê³ , 10ê°œë¥¼ ì¡°íšŒí•œë‹¤. ìœ„ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ì‹¤í–‰ ê²°ê³¼ë¡œ ë°œìƒí•˜ëŠ” ì¿¼ë¦¬ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-18-13-52-41.png" alt="" /></p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-18-13-52-56.png" alt="" /></p>

:ET