I"®f<p><br /><br /></p>

<h1 id="n1ë‹¤ëŒ€ì¼-ì—°ê´€ê´€ê³„-board-ë§Œë“¤ê¸°">&lt;N:1(ë‹¤ëŒ€ì¼) ì—°ê´€ê´€ê³„&gt; Board ë§Œë“¤ê¸°</h1>

<hr />

<p>ì—¬ê¸°ì„œëŠ” â€˜íšŒì›â€™ê³¼ â€˜ê²Œì‹œê¸€â€™ ê·¸ë¦¬ê³  â€˜ëŒ“ê¸€â€™ì´ë¼ëŠ” ì£¼ì œë¡œ JPAì—ì„œ ì—°ê´€ê´€ê³„ë¥¼ ê°€ì¥ ì‰½ê²Œ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì•Œì•„ë³¸ë‹¤.
ë¨¼ì € ì—°ê´€ê´€ê³„ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ë¥¼ í•´ì•¼ í•œë‹¤. :disappointed:</p>

<p><br /></p>

<p>â€˜íšŒì›â€™ê³¼ â€˜ê²Œì‹œê¸€â€™ì˜ ê´€ê³„ë¥¼ ë‹¤ìŒê³¼ ê°™ì€ ëª…ì œë¡œ ë‚˜íƒ€ë‚´ë³¸ë‹¤.</p>

<ul>
  <li>í•œ ëª…ì˜ íšŒì›ì€ ì—¬ëŸ¬ ê²Œì‹œê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.</li>
  <li>í•˜ë‚˜ì˜ ê²Œì‹œê¸€ì€ í•œ ëª…ì˜ íšŒì›ì— ì˜í•´ì„œ ì‘ì„±ëœë‹¤.</li>
</ul>

<p><br /></p>

<p>ì•„ë˜ ì‚¬ì§„ì„ ë³´ë©´ íšŒì› ë°ì´í„°ì˜ ì•„ì´ë””ëŠ” PKì— í•´ë‹¹í•œë‹¤. ì•„ì´ë””ëŠ” íšŒì›ì„ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ê³ ìœ í•œ ê°’ì„ ê°€ì§€ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.
ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ë³´ë©´ ì‘ì„±ì ì¹¼ëŸ¼ ê°’ìœ¼ë¡œ ë™ì¼í•œ íšŒì› ì•„ì´ë””ê°€ ì—¬ëŸ¬ ë²ˆ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. íšŒì› ë°ì´í„°ì˜ ì…ì¥ì—ì„œëŠ” í•˜ë‚˜(One)ì˜ PK(ì•„ì´ë””)ê°€ ì—¬ëŸ¬(Many) ê²Œì‹œê¸€ì—ì„œ ì°¸ì¡°(FK)ë˜ê³  ìˆëŠ” ê´€ê³„ê°€ ëœë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-16-21-00-46.png" alt="" /></p>

<p>íšŒì› ë°ì´í„° ìª½ì´ â€˜ì¼(one)â€™ì´ê³ , ê²Œì‹œê¸€ ë°ì´í„°ëŠ” ë™ì¼í•œ íšŒì› ì•„ì´ë””ê°€ ì—¬ëŸ¬ ë²ˆ ë‚˜ì˜¤ê³  ìˆìœ¼ë¯€ë¡œ â€˜ë‹¤(many)â€™ë¡œ íŒë‹¨í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ERDë¥¼ ì‘ì„±í•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-16-21-05-42.png" alt="" /></p>

<p><strong>ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê´€ê³„ë¥¼ í•´ì„í•  ë•ŒëŠ” í•­ìƒ PK ìª½ì—ì„œ í•´ì„í•˜ê³ , ì´ë¥¼ ë°˜ì˜í•´ì•¼ í˜¼ë€ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤</strong> :open_mouth:</p>

<p><br /></p>

<p>ì¦‰, ì•ì—ì„œ ì´ì•¼ê¸°í–ˆë˜ ë‘ ëª…ì œëŠ” ë‹¤ìŒê³¼ ê°™ì´ í•´ì„ë˜ì–´ì•¼ í•œë‹¤.</p>

<ul>
  <li>í•œ ëª…ì˜ íšŒì›ì€ ì—¬ëŸ¬ ê°œì˜ ê²Œì‹œê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤(PKì—ì„œ í•´ì„)</li>
  <li>í•˜ë‚˜ì˜ ê²Œì‹œê¸€ì€ í•œ ëª…ì˜ ì‘ì„±ìë§Œì„ í‘œì‹œí•  ìˆ˜ ìˆë‹¤.</li>
</ul>

<p><br /></p>

<p>ì´ì œ â€˜íšŒì›, ê²Œì‹œê¸€, ëŒ“ê¸€â€™ì˜ ê´€ê³„ë¥¼ PKë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ê³„í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ê°€ ëœë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-16-21-17-05.png" alt="" /></p>

<p>íšŒì›ì´ ìˆì–´ì•¼ ê²Œì‹œê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ íšŒì› í…Œì´ë¸”ì„ ë¨¼ì € ì„¤ê³„í•˜ê³  ê²Œì‹œê¸€ì„ ì‘ì„±í•  ë•ŒëŠ” íŠ¹ì • íšŒì›ê³¼ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤. ëŒ“ê¸€ì€ ê²Œì‹œê¸€ì´ ìˆì–´ì•¼ë§Œ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê²Œì‹œê¸€ì„ ìš°ì„  ì„¤ê³„í•˜ê³ , ëŒ“ê¸€ í…Œì´ë¸”ì´ ê²Œì‹œê¸€ì„ FKë¡œ ì‘ì„±í•œë‹¤.</p>

<p><br /></p>

<p>JPAëŠ” ê°ì²´ì§€í–¥ì˜ ì…ì¥ì—ì„œ ê´€ê³„ë¥¼ ë³´ëŠ”ë° ê°„ë‹¨í•œ ì‹œì‘ì€ ê°ì²´ì§€í–¥ë³´ë‹¤ëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ë§ì„ ìœ„ì£¼ë¡œ í•´ì„œ êµ¬ì„±í•˜ëŠ” ê²ƒì´ í¸ë¦¬í•˜ë‹¤.
:thumbsup:</p>

<hr />

<p><br /></p>

<h2 id="ì˜ˆì œ-í”„ë¡œì íŠ¸ì˜-ìƒì„±"><strong>ì˜ˆì œ í”„ë¡œì íŠ¸ì˜ ìƒì„±</strong></h2>

<p><br /><br /></p>

<p>í”„ë¡œì íŠ¸ì˜ ìƒì„±ì€ â€˜boardâ€™ë¼ëŠ” ì´ë¦„ì˜ í”„ë¡œì íŠ¸ë¡œ ìƒì„±í•˜ê³  Gradle, War í•­ëª©ì„ ì„ íƒí•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-16-21-23-58.png" alt="" /></p>

<p><br /></p>

<p>ì¶”ê°€í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” â€˜Spring Boot DevTools, Lombok, Spring Web, Thymeleaf, Spring Data JPA ë“±ì„ ì¶”ê°€í•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-16-21-24-30.png" alt="" /></p>

<p><br /></p>

<p>MariaDB JDBC ë“œë¼ì´ë²„ì™€ Thymeleafì˜ ì‹œê°„ ì²˜ë¦¬ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤.</p>

<p><em>â€œë‚˜ëŠ” mysqlë¥¼ ì„ í˜¸í•´ì„œ mysql connectorë¡œ ëŒ€ì‹ í–ˆë‹¤â€</em> :satisfied:</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-16-21-26-35.png" alt="" /></p>

<p><br /></p>

<p>application.properties íŒŒì¼ì—ëŠ” JPA ê´€ë ¨ ì„¤ì •ì„ ì¶”ê°€í•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-16-21-29-06.png" alt="" /></p>

<p><br /></p>

<p>í”„ë¡œì íŠ¸ ë‚´ì— entity íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•˜ê³ , ì´ì „ ì˜ˆì œì—ì„œ ì‚¬ìš©í–ˆë˜ BaseEntity í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤. ê·¸ë¦¬ê³  ë¯¸ë¦¬ dtoì™€ controller íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•´ ë†“ëŠ”ë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-17-18-12-05.png" alt="" /></p>

<p><br /></p>

<p><strong>BaseEntity í´ë˜ìŠ¤</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.annotation.CreatedDate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.annotation.LastModifiedDate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.domain.support.AuditingEntityListener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.EntityListeners</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.MappedSuperclass</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="nd">@MappedSuperclass</span>
<span class="nd">@EntityListeners</span><span class="o">(</span><span class="n">value</span><span class="o">={</span><span class="nc">AuditingEntityListener</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
<span class="nd">@Getter</span>
<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="o">{</span>
    <span class="nd">@CreatedDate</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"regdate"</span><span class="o">,</span><span class="n">updatable</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">regDate</span><span class="o">;</span>

    <span class="nd">@LastModifiedDate</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"moddate"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">modDate</span><span class="o">;</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>BoardApplicationì—ëŠ” @EnalbeJpaAuditingì„ ì¶”ê°€í•œë‹¤.</p>

<p><br /></p>

<p><strong>BoardApplication í´ë˜ìŠ¤</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.config.EnableJpaAuditing</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableJpaAuditing</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BoardApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">BoardApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>ì—°ê´€ê´€ê³„ì˜ ì„¤ì •ì€ ì²˜ìŒë¶€í„° ì„¤ì •í•˜ëŠ” ë°©ì‹ ë³´ë‹¤ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ë“¤ì„ êµ¬ì„±í•œ ì´í›„ì— ê° ì—”í‹°í‹° í´ë˜ìŠ¤ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê³ ë¯¼í•´ì„œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ë” ìˆ˜ì›”í•˜ë‹¤.
entity íŒ¨í‚¤ì§€ì— Member(íšŒì›), Board(ê²Œì‹œë¬¼), Reply(ëŒ“ê¸€) ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-17-18-23-25.png" alt="" /></p>

<p>íšŒì› ì—”í‹°í‹° í´ë˜ìŠ¤ëŠ” ìµœê·¼ì— ë§ì´ ì‚¬ìš©í•˜ëŠ” ì´ë©”ì¼(email)ì„ ì‚¬ìš©ìì˜ ì•„ì´ë”” ëŒ€ì‹ ì— ì‚¬ìš©í•œë‹¤.</p>

<p><br /></p>

<p><strong>Member í´ë˜ìŠ¤</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Member í´ë˜ìŠ¤ëŠ” ì´ë©”ì¼ ì£¼ì†Œë¥¼ PKë¡œ ì‚¬ìš©í•œë‹¤. ë”°ë¡œ FKë¥¼ ì‚¬ìš©í•˜ì§„ ì•ŠëŠ”ë‹¤. ê·¸ë˜ì„œ ë³„ë„ì˜ ì°¸ì¡°ê°€ í•„ìš”ê°€ ì—†ë‹¤.</p>

<p>Board í´ë˜ìŠ¤ëŠ” Memberì˜ ì´ë©”ì¼(PK)ì„ FKë¡œ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>

<p><br /></p>

<p><strong>Board í´ë˜ìŠ¤</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span><span class="o">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="s">"writer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>Reply í´ë˜ìŠ¤ëŠ” íšŒì›ì´ ì•„ë‹Œ ì‚¬ëŒë„ ëŒ“ê¸€ì„ ë‚¨ê¸¸ ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•˜ê³  Boardì™€ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì§€ ì•Šì€ ìƒíƒœë¡œ ì²˜ë¦¬í•œë‹¤.</p>

<p><br /></p>

<p><strong>Reply í´ë˜ìŠ¤</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span><span class="o">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="s">"board"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reply</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">rno</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">text</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">replyer</span><span class="o">;</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ë¡œ ë³´ë©´ ì•ìœ¼ë¡œ ìƒì„±ë  board í…Œì´ë¸”ê³¼ member í…Œì´ë¸”ì—ëŠ” FKë¥¼ ì´ìš©í•œ ì°¸ì¡°ê°€ ê±¸ë ¤ ìˆê²Œ ëœë‹¤. member ìª½ì˜ emailì„ boardì—ì„œëŠ” FKë¡œ ì°¸ì¡°í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-17-19-00-48.png" alt="" /></p>

<p>boardì™€ member ê´€ê³„ëŠ” N:1(ë‹¤ëŒ€ì¼)ì˜ ê´€ê³„ê°€ ë˜ë¯€ë¡œ JPAì—ì„œëŠ” ì´ë¥¼ ì˜ë¯¸í•˜ëŠ” @ManyToOneì„ ì ìš©í•œë‹¤.</p>

<p><em><strong>@ManyToOneì€ ë°ì´í„°ë² ì´ìŠ¤ìƒì—ì„œ ì™¸ë˜í‚¤ì˜ ê´€ê³„ë¡œ ì—°ê²°ëœ ì—”í‹°í‹° í´ë˜ìŠ¤ì— ì„¤ì •í•œë‹¤.</strong></em></p>

<p>ë³´ë©´ member ì—”í‹°í‹°ì˜ PKê°€ emailì´ë‹ˆê¹Œ board í´ë˜ìŠ¤ì—ì„œ ì €ë ‡ê²Œ Member writer ìœ„ì— ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ @ManyToOneë¥¼ í•´ì£¼ë©´ ìë™ìœ¼ë¡œ emailê³¼ ì—°ê´€ëœ FKê°€ ìƒì„±ë˜ëŠ” ê²ƒì´ë‹¤.</p>

<p><br /></p>

<p><strong>Board í´ë˜ìŠ¤ì˜ ë³€ê²½</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span><span class="o">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="s">"writer"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Board</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span><span class="o">=</span><span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Member</span> <span class="n">writer</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Reply ìª½ì—ì„œëŠ” Board ìª½ì˜ PKë¥¼ ì°¸ì¡°í•´ì„œ êµ¬ì„±ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤.</p>

<p><br /></p>

<p><strong>Reply í´ë˜ìŠ¤ ë³€ê²½</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span><span class="o">(</span><span class="n">exclude</span> <span class="o">=</span> <span class="s">"board"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reply</span> <span class="kd">extends</span> <span class="nc">BaseEntity</span><span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">rno</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">text</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">replyer</span><span class="o">;</span>
    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span><span class="o">=</span><span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Board</span> <span class="n">board</span><span class="o">;</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•´ì„œ í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ê°€ ì •ìƒì ìœ¼ë¡œ ë§Œë“¤ì–´ì¡ŒëŠ”ì§€ í™•ì¸ì„ í•œë‹¤.
í…Œì´ë¸”ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆë‹¤ë©´ ê° ì—”í‹°í‹°ì— ë§ëŠ” Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part3/Chapter5/2021-02-17-19-10-56.png" alt="" /></p>

<p><br /></p>

<p><strong>MemberRepository ì¸í„°í˜ì´ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p><strong>BoardRepository ì¸í„°í˜ì´ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.board.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.JpaRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.repository.query.Param</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.entity.Board</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.zerock.board.repository.search.SearchBoardRepository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BoardRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Board</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">SearchBoardRepository</span> <span class="o">{</span>
    <span class="c1">//í•œ ê°œì˜ ë¡œìš°(Object) ë‚´ì— Object[]ë¡œ ë‚˜ì˜´</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"select b, w from Board b left join b.writer w where b.bno=:bno"</span><span class="o">)</span>
    <span class="nc">Object</span> <span class="nf">getBoardWithWriter</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"bno"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">);</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT b, r FROM Board b LEFT JOIN Reply r ON r.board=b WHERE b.bno=:bno"</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="nf">getBoardWithReply</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"bno"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">);</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"SELECT b, w, count(r) "</span> <span class="o">+</span>
    <span class="s">" FROM Board b "</span><span class="o">+</span>
    <span class="s">" LEFT JOIN b.writer w "</span><span class="o">+</span>
    <span class="s">" LEFT JOIN Reply r ON r.board=b"</span><span class="o">+</span>
    <span class="s">" GROUP BY b"</span><span class="o">,</span>
    <span class="n">countQuery</span> <span class="o">=</span><span class="s">"SELECT count(b) FROM Board b"</span><span class="o">)</span>
    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="nf">getBoardWithReplyCount</span><span class="o">(</span><span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

    <span class="nd">@Query</span><span class="o">(</span><span class="s">"SELECT b, w, count(r) "</span> <span class="o">+</span>
    <span class="s">" FROM Board b LEFT JOIN b.writer w "</span> <span class="o">+</span>
    <span class="s">" LEFT OUTER JOIN Reply r ON r.board=b"</span><span class="o">+</span>
    <span class="s">" WHERE b.bno= :bno"</span><span class="o">)</span>
    <span class="nc">Object</span> <span class="nf">getBoardByBno</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">"bno"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">bno</span><span class="o">);</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p><strong>ReplyRepository ì¸í„°í˜ì´ìŠ¤</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>
</pre></td></tr></tbody></table></code></pre></div></div>
:ET